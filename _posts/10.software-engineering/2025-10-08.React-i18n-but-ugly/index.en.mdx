---
title: 'React i18n but ugly'
excerpt: >
  Behold! A backend developer will teach you how to frontend. But the main point is to demonstrate how to engineer an ugly solution of already solved problem that makes sense.
image: 'react-i18n-but-ugly.webp'
---

Behold! A backend developer will teach you how to frontend.

But the main point is to demonstrate how to engineer an ugly solution of already solved problem that makes sense.

## Scope

Mostly static site, React, Next.js App Router, markdown blog with multiple languages.

**Readily available**: react-intl or i18next.
#### Problem #1Â 

`output: "export"` means no middleware, no cookies, no runtime detection â€” we rely on the filesystem.

#### Problem #2 (the showstopper)

What youâ€™re â€œsupposedâ€ to do is to create and maintain:

```txt
messages-en.json
messages-es.json
messages-fr.json
....
```

#### That means

- I need to repeat the website structure in each of these files
- Every time I need to add, tweak, or move a button, I need to modify all `messages-${lang}.json` files simultaneously

#### Pragmatically

- I'm not too crazy about rendering "X user(s) (is/are) on the page"
- I donâ€™t outsource translations; I donâ€™t need detachable files
- I can leverage LLMs to create at least initial translations

At this point, I want to create my own solution â€” just to compare maintenance costs.

Key point of this step is to

- **scope the requirements** â€” make way to a minimalistic tailor-made solution, and
- **prototyping** â€” I don't try to make an ideal design, I delete code and move forward

## Let's go ugly!

### Step 1: hardcode JSON

![](all-the-things.webp)

1. `messages-${lang}.json` are part of the application, not configuration (a missing message is a defect).
2. Leverage the TypeScript compiler to catch missing or misplaced translations.
3. Express content hierarchy in pure TypeScript.

### Step 2: put everything in one file

```text
/i18n
â””â”€â”€ index.ts
```

```typescript

const i18n = {
  en: {
    name: 'English',
    emoji: 'ğŸ‡¬ğŸ‡§',
    title: 'The website in English',
    .....
  },
  uk: {
    name: 'Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°',
    emoji: 'ğŸ‡ºğŸ‡¦',
    title: 'Ğ¡Ñ‚Ğ¾Ñ€Ñ–Ğ½ĞºĞ° Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ¡Ğ¾Ğ»Ğ¾Ğ²Ê¼Ñ—Ğ½Ğ¾Ñ',
    .....
  },

  .....

} as const;
```

### Step 3: re-invent framework anyway

```typescript
// The Lang union type is derived from the i18n structure keys
export type Lang = keyof typeof i18n; // 'en' | 'uk'

// all nested keys inside i18n:
// "en.title", "uk.title", "en.rootPage.heroCTA", ... and so on
type Path<T> = T extends object
  ? {
    [K in keyof T]: K extends string ? K | `${K}.${Path<T[K]>}` : never;
  }[keyof T]
  : never;

type I18nPath = Path<(typeof i18n)[Lang]>;

export const getTranslations =
  (lang: string) =>
    (path: I18nPath): string => {
      if (!(lang in i18n)) return String(path);

      const keys = path.split('.');
      let i18node: any = i18n[lang as Lang];

      for (const key of keys) {
        if (i18node && typeof i18node === 'object' && key in i18node) {
          i18node = i18node[key];
        } else {
          return String(path);
        }
      }

      return typeof i18node === 'object'
        ? String(path)
        : String(i18node);
    };
```


From the end-user perspective, everything looks like business as usual.
But now `getTranslations` with non-existing key can cause a compilation error.
Additionally, we may require that the key must be defined in all languages.

(Relaxed gradual degradation vs. strictness).

```typescript
// usage example
export default function Footer({ lang }: { lang: Lang }) {
  const t = getTranslations(lang);
  const currentYear = new Date().getFullYear();

  return (
    <footer>
      <p> Â© {currentYear} {t('title')} </p>
    </footer >
  );
}
```

### we have a new ugly solution to already solved problem â€” now what?

I'm showing you the intermediate results. I think this is an important step of the engineering process â€” to stop and re-evaluate, and frankly my solution so far doesn't look any better.

#### PROS:

- missing / misspelled keys are compilation errors
- I don't need to keep multiple JSON in sync, ensuring the keys are present and the structure is identical

#### CONS:

- I have one bulky file with nested structures â€” it doesn't scale
- I reinvented the wheel, made it less capable, and I have to maintain it now

## Shape the final solution

### It's not an i18n problem

I'm struggling to separate the content of a static website from layout and styles â€” i18n is only part of the problem.
That means what I thought of as a `i18n` is a "Static Content Tree" suitable for all types of content, like icons, images, and links.

### I don't need to mimic any framework

The framework-ish `getTranslations(lang)` can go away, I can directly use `i18n['lang'].title` for better error handling and reporting.
With `getTranslations` gone, I don't need a rigid structure: `<lang>: { <subtree> }` anymore, the structure could be flexible, as I see fit

```typescript
import { FaHome } from 'react-icons/fa';

export const navData = [
  {
    title: {
      en: "Home",
      uk: "ĞĞ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ½Ñƒ",
    },
    icon: FaHome,
    href: "/",
  },

  ...

] as const;

```

And splitting by files should follow the website structure â€” what is often modified together, should live together
#### Before

```text
/i18n
â””â”€â”€ index.ts (The God Object)
```

#### After

```text
/i18n
â””â”€â”€ common-components.ts
â””â”€â”€ nav-panel.ts
â””â”€â”€/root-page
   â””â”€â”€index.ts
   â””â”€â”€hero-section.ts
...
```

#### Out of scope

Mature internalization frameworks are better suited for dynamically generated content: pluralization, time localization, and so on.
Should I require this functionality at some point, I could easily generate the content in the form of `messages.<lang>.json` from my hardcoded literals, so I could have a cake and eat it too.

<TLDR title="If everybody does it, it doesn't mean you should" />

- Frameworks may be an overkill for static websites
- Scoping the requirements helps with minimalistic solutions â€” YAGNI
- Iteration and re-evaluation over ideal design
- [This website](https://github.com/aka-rider/aka-rider.github.io)

---
<small className="text-xs text-gray-500" >
Yours `-> ğŸ‘ <-` motivates to write

Photo by [sunday Choi](https://unsplash.com/@gosunday85) on [Unsplash](https://unsplash.com/photos/danke-thanks-grazie-merci-RpXMySRW0AE)
</small>
